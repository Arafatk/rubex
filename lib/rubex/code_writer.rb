module Rubex
  class CodeWriter
    attr_reader :code

    def initialize target_name
      @code = "/* C extension for #{target_name}.\n"\
                 "This file in generated by Rubex. Do not change!\n"\
               "*/\n"
      @indent = 0
    end

    def write_func_declaration return_type, c_name
      @code << "#{return_type} #{c_name} "
      @code << "("
      @code << "int argc, VALUE* argv, VALUE #{Rubex::ARG_PREFIX}self"
      @code << ");"
      new_line
    end

    def write_func_definition_header return_type, c_name
      @code << "#{return_type} #{c_name} "
      @code << "("
      @code << "int argc, VALUE* argv, VALUE #{Rubex::ARG_PREFIX}self"
      @code << ")"
      @code << "\n"
      @code << "{\n"
    end

    def declare_variable var
      @code << "#{var.type.to_s} #{var.c_name};\n"
    end
    
    def << s
      @code << s
    end

    def new_line
      @code << "\n"
    end

    def indent
      @indent += 1
    end

    def dedent
      raise "Cannot dedent, already 0." if @indent == 0
      @indent -= 1
    end
  end
end
